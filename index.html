<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>フリマ商品説明作成ツール v8</title>
    <style>
        :root { --primary: #1c1c1e; --accent: #007AFF; --bg: #f5f5f7; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 10px; color: #333; line-height: 1.4; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h1 { font-size: 1.1rem; text-align: center; margin-bottom: 20px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        .section { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #e5e5ea; }
        .hidden { display: none; }
        label { display: block; font-weight: bold; margin-bottom: 6px; font-size: 0.85rem; color: #555; }
        select, input { width: 100%; padding: 12px; border: 1px solid #d1d1d6; border-radius: 10px; font-size: 1rem; box-sizing: border-box; margin-bottom: 12px; background: #fff; appearance: none; }
        .checkbox-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 5px; }
        .checkbox-item { display: flex; align-items: center; font-size: 0.8rem; background: #f2f2f7; padding: 8px; border-radius: 8px; }
        .checkbox-item input { width: 20px; height: 20px; margin-right: 8px; margin-bottom: 0; }
        .sub-panel { background: #f9f9fb; padding: 15px; border-radius: 10px; border: 1px solid #e5e5ea; margin-top: 10px; }
        button { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.98); opacity: 0.8; }
        #output-area { margin-top: 20px; padding: 15px; background: #2c2c2e; color: #fff; font-family: monospace; font-size: 0.75rem; white-space: pre-wrap; border-radius: 10px; display: none; }
        .required { color: #ff3b30; margin-left: 2px; }
    </style>
</head>
<body>

<div class="container">
    <h1>商品説明ジェネレーター v8</h1>

    <div class="section">
        <label>商品名 <span class="required">*</span></label>
        <select id="productId" onchange="updateUI()"></select>
    </div>

    <div class="section">
        <div id="wrapperCharging" class="hidden">
            <label>充電方式</label>
            <select id="chargingMethod" onchange="updateUI()">
                <option value="">選択なし</option>
                <option value="Lightning">Lightning</option>
                <option value="USB-C">USB-C</option>
            </select>
        </div>
        <div id="wrapperSpec" class="hidden">
            <label>スペック</label>
            <select id="spec" onchange="updateUI()"></select>
        </div>
        <div id="wrapperSize" class="hidden">
            <label>サイズ</label>
            <select id="size"></select>
        </div>
        <div id="wrapperColor" class="hidden">
            <label>カラー</label>
            <select id="color" onchange="updateUI()"></select>
        </div>
    </div>

    <div class="section">
        <label>同梱物 (複数選択)</label>
        <div id="accessoriesGroup" class="checkbox-group"></div>
        
        <div id="bandDetails" class="sub-panel hidden">
            <label>バンドサイズ</label>
            <select id="bandSize">
                <option value="">選択してください</option>
                <option value="S／M">S／M</option>
                <option value="M／L">M／L</option>
            </select>
            <label>バンドカラー</label>
            <input type="text" id="bandColor" placeholder="例：ミッドナイト">
            <label>バンド状態</label>
            <select id="bandCondition">
                <option value="">選択してください</option>
                <option value="使用感がほとんどない未使用に近いものです。">未使用に近い</option>
                <option value="裏面にスレがありますが黄ばみやベタつき、致命傷はありません。">微スレあり・致命傷なし</option>
                <option value="使用感はありますが、問題なく着用可能です。">使用感あり・着用可能</option>
            </select>
        </div>
    </div>

    <div class="section">
        <label>外観状態 <span class="required">*</span></label>
        <select id="condition" onchange="updateUI()">
            <option value="">選択してください</option>
            <option value="使用感が少ない「未使用に近い」状態">未使用に近い</option>
            <option value="目立つ傷、スレがない「とても良好」な状態">とても良好</option>
            <option value="小傷、微スレありますが「致命傷のない」状態">致命傷なし</option>
            <option value="傷、スレありますが「十分に使用可能」な状態">使用可能</option>
            <option value="未開封の「新品／未使用」状態">未開封の「新品／未使用」</option>
        </select>
        
        <div id="appearancePanel">
            <div id="boxA"><label id="labelA">詳細A</label><select id="detailA"></select></div>
            <div id="boxB"><label id="labelB">詳細B</label><select id="detailB"></select></div>
            <div id="boxC"><label id="labelC">詳細C</label><select id="detailC"></select></div>
            <div id="fixedText" class="sub-panel hidden">新品未開封の状態です。</div>
        </div>
        <label style="margin-top:10px;">外観備考 (任意)</label>
        <input type="text" id="appearanceNotes" placeholder="例：液晶保護フィルム貼付済み">
    </div>

    <div class="section">
        <label id="batteryLabel">バッテリー最大容量 (%)</label>
        <input type="number" id="battery" placeholder="0-100">
        
        <label>保証 (任意)</label>
        <select id="warranty">
            <option value="">選択なし</option>
            <option value="Apple Care Service">Apple Care Service</option>
            <option value="AppleCare+">AppleCare+</option>
            <option value="Apple製品限定保証">Apple製品限定保証</option>
        </select>

        <div id="wrapperNet" class="hidden">
            <label>ネットワーク利用制限</label>
            <select id="netRestriction">
                <option value="">選択してください</option>
                <option value="-">-</option>
                <option value="○">○</option>
            </select>
        </div>
    </div>

    <div class="section">
        <label>配送ランク <span class="required">*</span></label>
        <select id="shippingRank"></select>
    </div>

    <button onclick="generate()">説明文を生成＆コピー</button>
    <div id="output-area"></div>
</div>

<script>
// Master Data from system-core-code.tsx
const PRODUCTS = {
  "1": { name: "Apple Watch SE 第2世代", cat: "watch" },
  "2": { name: "Apple Watch SE 第3世代", cat: "watch" },
  "3": { name: "Apple Watch Series 10", cat: "watch" },
  "4": { name: "Apple Watch Series 11", cat: "watch" },
  "5": { name: "Apple AirPods 4", cat: "airpods" },
  "6": { name: "Apple AirPods 4 ANC", cat: "airpods" },
  "7": { name: "Apple AirPods Pro 第2世代", cat: "airpods" },
  "8": { name: "Apple AirPods Pro 第3世代", cat: "airpods" },
  "9": { name: "Apple Pencil 第1世代", cat: "pencil" },
  "10": { name: "Apple Pencil 第2世代", cat: "pencil" },
  "11": { name: "Apple HomePod mini", cat: "homepod" },
  "12": { name: "Apple Magic Trackpad 3 (Multi-Touch対応)", cat: "trackpad" },
};

const MASTER = {
    specs: { "1": ["GPS Cellular", "GPS"], "2": ["GPS Cellular", "GPS"], "7": ["USB-C", "Lightning"] },
    sizes: { "1": ["40mm", "44mm"], "2": ["40mm", "44mm"], "3": ["42mm", "46mm"], "4": ["42mm", "46mm"] },
    colors: {
        "1": ["ミッドナイト", "スターライト", "シルバー"],
        "3": ["ジェットブラック", "シルバー", "ローズゴールド"],
        "4": ["ジェットブラック", "シルバー", "ローズゴールド", "スペースグレイ"],
        "11": ["ブルー", "ホワイト", "ミッドナイト", "スペースグレイ"],
        "12": ["ブラック", "ホワイト"]
    },
    shipping: {
        "A": { label: "A - ゆうパケット（送料無料）", text: "■ゆうパケット（送料無料）\n・配送補償：あり\n・日時指定／コンビニ受取：不可\n・置き配：不可\n\n■宅急便コンパクト（＋350円）\n・配送補償：あり\n・日時指定／コンビニ受取：可能\n・置き配：可能\n\n※変更を希望される場合は、購入前にご申告ください。" },
        "B": { label: "B - 宅急便コンパクト（送料無料）", text: "■宅急便コンパクト（送料無料）\n・日時指定／コンビニ受取（可）\n・置き配（可）" },
        "C": { label: "C - 宅急便（送料無料）", text: "■宅急便（送料無料）\n・日時指定／コンビニ受取（可）\n・置き配（可）" }
    },
    accs: ["未使用バンド（互換品）", "スポーツバンド（アップル純正）", "充電ケーブル（テスト用）", "充電ケーブル（アップル純正）", "イヤーチップ", "ACアダプター", "新品同梱品と同じ", "外箱", "外箱／リーフレット"],
    details: {
        watch: { A: ["画面は肉眼でわかる傷、スレ、割れはありません。", "画面は肉眼では気にならない程度の薄いスレがありますが、目立つ傷はありません。", "画面は浅めの傷やスレがありますが、操作性や視認性に影響はありません。"], B: ["側面は肉眼でわかる傷、スレ、剥げはありません。", "側面は微細な剥げがありますが、目立つ傷はありません。", "デジタルクラウンに微細な剥げがありますが、操作性に影響はありません。"], C: ["背面は目立つ傷、スレ、剥げなどはなく使用感は少なめです。", "背面に微細な剥げがありますが、装着時には気にならない箇所です。", "ベルト接続部に微細な剥げがありますが、装着時には気にならない箇所です。"] },
        audio: { A: ["ケース外装は、肉眼でわかる傷、スレ、汚れがほとんどありません。", "ケース外装は、浅い傷や微細なスレがありますが目立つ傷はありません。", "ケース外装は、浅い傷やスレ、使用感がありますが使用に問題はありません。"], B: ["ケース内側は、肉眼でわかる傷、スレ、汚れがほとんどありません。", "ケース内側は、薄い汚れや微細な擦れ等はありますが、目立つ傷はありません。", "ケース内側は、やや使用感がありますが使用に問題はありません。"], C: ["イヤホン本体は、肉眼でわかる傷、スレ、汚れがほとんどありません。", "イヤホン本体は、浅い傷や微細なスレがありますが1cm以上の大きな傷はありません。", "イヤホン本体は、細かい傷やスレ、使用感がありますが使用に問題はありません。"] },
        homepod: { A: ["パネル面は肉眼でわかる傷、スレ、割れはありません。", "パネル面は肉眼では気にならない程度の薄いスレがありますが、目立つ傷はありません。", "パネル面は浅めの傷やスレがありますが、操作性や視認性に影響はありません。"], B: ["側面は肉眼でわかる傷、スレ、割れはありません。", "側面は肉眼では気にならない程度の薄いスレがありますが、目立つ傷はありません。", "側面は浅めの傷やスレがありますが、使用に影響はありません。"], C: ["底面は肉眼でわかる傷、スレ、割れはありません。", "底面は肉眼では気にならない程度の薄いスレがありますが、目立つ傷はありません。", "底面は浅めの傷やスレがありますが、使用に影響はありません。"] },
        trackpad: { A: ["トラックパッド操作面は肉眼でわかる傷、スレ、汚れがほとんどありません。", "トラックパッド操作面は微細なスレやわずかな使用感はありますが、比較的キレイな状態です。", "トラックパッド操作面は細かい傷やスレがありますが、操作性には影響ありません。"], B: ["トラックパッド底面は肉眼でわかる傷、スレ、汚れ、ゴムの劣化がほとんどありません。", "トラックパッド底面は薄い汚れやスレ等はありますが、目立つ傷はなくゴムの劣化も少なめで操作性に影響はありません。", "トラックパッド底面はやや使用感がありスレ等はあり、ゴムも少々劣化していますが、操作性に影響はありません。"] }
    }
};

function init() {
    const pSel = document.getElementById('productId');
    pSel.innerHTML = '<option value="">選択してください</option>';
    Object.entries(PRODUCTS).forEach(([id, p]) => pSel.innerHTML += `<option value="${id}">${p.name}</option>`);

    const accGroup = document.getElementById('accessoriesGroup');
    MASTER.accs.forEach(a => accGroup.innerHTML += `<div class="checkbox-item"><input type="checkbox" value="${a}" onchange="updateUI()"> ${a}</div>`);

    const sRank = document.getElementById('shippingRank');
    Object.entries(MASTER.shipping).forEach(([id, r]) => sRank.innerHTML += `<option value="${id}">${r.label}</option>`);
}

function updateUI() {
    const pid = document.getElementById('productId').value;
    const cond = document.getElementById('condition').value;
    const spec = document.getElementById('spec').value;
    const isUnopened = cond === "未開封の「新品／未使用」状態";

    // Visibility logic from React Core
    document.getElementById('wrapperCharging').classList.toggle('hidden', !["7", "12"].includes(pid));
    document.getElementById('wrapperSpec').classList.toggle('hidden', !MASTER.specs[pid]);
    document.getElementById('wrapperSize').classList.toggle('hidden', !MASTER.sizes[pid]);
    document.getElementById('wrapperColor').classList.toggle('hidden', !MASTER.colors[pid]);
    document.getElementById('wrapperNet').classList.toggle('hidden', spec !== "GPS Cellular");

    // Dynamic Selects
    if(MASTER.specs[pid]) fillSelect('spec', MASTER.specs[pid]);
    if(MASTER.sizes[pid]) fillSelect('size', MASTER.sizes[pid]);
    if(MASTER.colors[pid]) fillSelect('color', MASTER.colors[pid]);

    // Battery Label
    document.getElementById('batteryLabel').innerText = ["5", "6", "7", "8", "12"].includes(pid) ? "10分間の消費バッテリー（%）" : "バッテリー最大容量（%）";

    // Appearance Details
    const apPanel = document.getElementById('appearancePanel');
    apPanel.classList.toggle('hidden', isUnopened || !pid);
    const boxC = document.getElementById('boxC');
    
    if(pid && !isUnopened) {
        let type = PRODUCTS[pid].cat;
        if(pid === "12") boxC.classList.add('hidden'); else boxC.classList.remove('hidden');
        if(["9", "10"].includes(pid)) {
            document.getElementById('fixedText').classList.remove('hidden');
            ['boxA','boxB','boxC'].forEach(b => document.getElementById(b).classList.add('hidden'));
        } else {
            document.getElementById('fixedText').classList.add('hidden');
            ['boxA','boxB','boxC'].forEach(b => document.getElementById(b).classList.remove('hidden'));
            const dataSet = MASTER.details[type === "pencil" ? "audio" : (type === "watch" ? "watch" : (type === "airpods" ? "audio" : type))];
            fillDetail('A', dataSet.A); fillDetail('B', dataSet.B); fillDetail('C', dataSet.C);
        }
    }

    // Band Details Panel
    const hasGenuine = Array.from(document.querySelectorAll('#accessoriesGroup input:checked')).some(i => i.value === "スポーツバンド（アップル純正）");
    document.getElementById('bandDetails').classList.toggle('hidden', !hasGenuine);
}

function fillSelect(id, arr) {
    const el = document.getElementById(id);
    if(el.options.length > 1) return;
    arr.forEach(v => el.innerHTML += `<option value="${v}">${v}</option>`);
}

function fillDetail(suffix, arr) {
    const el = document.getElementById('detail' + suffix);
    el.innerHTML = '<option value="">-- 選択してください --</option>';
    if(arr) arr.forEach(v => el.innerHTML += `<option value="${v}">${v}</option>`);
}

// Logic from getKw function (system-core-code.tsx)
function getKeywords(pid, charging, color) {
    if (pid === "7") return charging === "USB-C" ? "MTJV3J/A AirPodsPro2" : "MQD83J/A AirPodsPro2";
    if (pid === "8") return "MFHP4J/A AirPodsPro3";
    if (pid === "6") return "MXP93J/A AirPods4";
    if (pid === "5") return "MXP63J/A AirPods4";
    if (pid === "12") {
        if (charging === "Lightning") return color === "ブラック" ? "MMMP3ZA/A" : "MK2D3ZA/A";
        return color === "ブラック" ? "MXKA3ZA/A" : "MXK93ZA/A";
    }
    return "";
}

function generate() {
    const pid = document.getElementById('productId').value;
    if(!pid || !document.getElementById('condition').value) return alert("必須項目を入力してください");

    const p = PRODUCTS[pid];
    const charging = document.getElementById('chargingMethod').value;
    const spec = document.getElementById('spec').value;
    const size = document.getElementById('size').value;
    const color = document.getElementById('color').value;
    const cond = document.getElementById('condition').value;
    const kw = getKeywords(pid, charging, color);

    const accessories = Array.from(document.querySelectorAll('#accessoriesGroup input:checked')).map(i => i.value);
    const isNewBundle = accessories.includes("新品同梱品と同じ");

    // Build Text (Logic from generatedText in React)
    let text = `${p.name} ${charging} ${spec} ${size} ${color} ${kw}`.replace(/\s+/g, ' ').trim() + "\n\n";
    text += "━━━━━━━━━━━━━━━━━━━━\n商品説明\n━━━━━━━━━━━━━━━━━━━━\n\n【同梱物】\n";
    if(!isNewBundle) text += "・本体\n";
    accessories.forEach(a => text += `・${a}\n`);
    if(!isNewBundle) text += "\n※未記載の物（外箱・説明書等）は発送できません。\n";

    text += `\n【外観状態】\n■${cond}\n`;
    if(cond !== "未開封の「新品／未使用」状態") {
        if(["9", "10"].includes(pid)) text += "新品未開封の状態です。\n";
        else {
            text += `${document.getElementById('detailA').value}\n${document.getElementById('detailB').value}\n`;
            if(pid !== "12") text += `${document.getElementById('detailC').value}\n`;
        }
        text += "\n※簡易清掃を行なった上で、撮影を行なっています。\n画像に写らない微細な傷等がある場合がありますので、ご了承ください。\n\n■動作不良・機能不具合等は、ありません。\n";
    }

    // Battery Logic
    const bVal = document.getElementById('battery').value;
    if(bVal) {
        if(["5", "6", "7", "8"].includes(pid)) text += `・バッテリーは、10分の音楽再生で約${bVal}％消費\n※製品仕様上、バッテリー最大容量は数値化できません。\n\n`;
        else if(pid === "12") text += `・バッテリーは、10分の接続で約${bVal}％消費\n※製品仕様上、バッテリー最大容量は数値化できません。\n\n`;
        else text += `・バッテリー最大容量は「${bVal}%」です。\n\n`;
    }

    // Reset Logic
    if(p.cat === "trackpad") text += "・本体のリセット済み\n";
    else if(p.cat === "airpods") text += "・本体の初期化、アカウント連携解除済み（探す機能、使用可能）\n";
    else text += "・本体の初期化、アクティベーションロック解除済み\n";

    const net = document.getElementById('netRestriction').value;
    if(net) text += `・ネットワーク利用制限：${net}\n`;

    const warranty = document.getElementById('warranty').value;
    if(warranty) {
        text += `\n■${warranty}\n`;
        if(warranty === "Apple Care Service") text += "（AppleCare+の通信キャリア版で保証内容は同等です）\n";
        else if(warranty === "AppleCare+") text += "（故障・盗難・紛失時に割安でサポート対応）\n";
        else text += "（Appleの保証サービス）\n";
    }

    text += "\n━━━━━━━━━━━━━━━━━━━━\n発送／補償\n━━━━━━━━━━━━━━━━━━━━\n\n・15時までの支払い完了で【当日発送】します。\n\n■お支払い方法\n・PayPay\n・クレジットカード\n※クレジットカードの承認は、4時間程度かかります。\n　承認が15:00以降の場合は、翌日発送となります。\n\n";
    
    const rank = document.getElementById('shippingRank').value;
    text += MASTER.shipping[rank].text + "\n\n";

    if(accessories.includes("充電ケーブル（テスト用）")) text += "※充電ケーブル（テスト用）は、受取時の動作確認用です。耐久性や品質は保証致しかねます。\n\n";

    if(isNewBundle) {
        text += "※新品・未開封品ですが、あくまでも二次流通品となります。\n価格交渉は、販売時点の相場、出品期間等を踏まえて価格相談機能でのみ回答します。\n\n※新品・未開封品ですが、万が一初期不良があった場合はご連絡ください。";
    } else {
        text += "※中古品の性質上、傷の具合やバッテリーの消耗等、全く同じ製品はありません。\n価格交渉は、販売時点の相場、出品期間等を踏まえて価格相談機能でのみ回答します。\n\n※商品説明にない動作不良や機能不具合があった場合は、返品／返金します。";
    }

    document.getElementById('output-area').innerText = text;
    document.getElementById('output-area').style.display = 'block';
    navigator.clipboard.writeText(text).then(() => alert("コピーしました！"));
}

init();
</script>
</body>
</html>
